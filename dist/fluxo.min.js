/*! fluxo v0.0.11 | (c) 2014, 2015 Samuel SimÃµes |  */
!function(a,b){if("function"==typeof define&&define.amd)define([],b);else{if("undefined"!=typeof exports)return module.exports=b();a.Fluxo=b()}}(this,function(){var a={storesUUID:1};a.extend=function(a){a=a||{};for(var b=Array.prototype.slice.call(arguments,1),c=0,d=b.length;d>c;c++){var e=b[c];for(var f in e)a[f]=e[f]}return a};var b=function(b,c){var d,e=this;d=function(){return e.apply(this,arguments)},a.extend(d,e,c);var f=function(){this.constructor=d};return f.prototype=e.prototype,d.prototype=new f,b&&a.extend(d.prototype,b),d.__super__=e.prototype,d};return a.Radio={callbackIds:1,events:{},subscribe:function(a,b){var c=this.callbackIds++;return this.events[a]=this.events[a]||{},this.events[a][c]=b,this.removeSubscription.bind(this,a,c)},removeSubscription:function(a,b){this.events[a]=this.events[a]||{},delete this.events[a][b]},publish:function(a){var b=this.events[a]||{};for(var c in b)b[c].apply(null,Array.prototype.slice.call(arguments,1))}},a.Base=function(){var b=Array.prototype.slice.call(arguments);this.data={},this.options=b[1]||{},this.changeEventToken=a.storesUUID++,this._constructor.apply(this,b)},a.Base.extend=b,a.Base.prototype={initialize:function(){},on:function(b,c){for(var d=[],e=0,f=b.length;f>e;e++){var g=b[e],h=this.changeEventToken+":"+g,i=a.Radio.subscribe(h,c.bind(this));d.push(i)}var j=function(){for(var a=0,b=d.length;b>a;a++){var c=d[a];c.call()}};return j},trigger:function(b){for(var c=0,d=b.length;d>c;c++){var e=b[c];a.Radio.publish(this.changeEventToken+":"+e)}},computed:{},attributeParsers:function(){},registerComputed:function(){for(var a in this.computed){var b=this.computed[a];this.on(b,function(a){var b=this[a].call(this);this.setAttribute(a,b)}.bind(this,a)),this.setAttribute(a,this[a].call(this))}},setAttribute:function(a,b,c){c=c||{},this.data[a]!==b&&(this.attributeParsers[a]&&(b=this.attributeParsers[a](b)),this.data[a]=b,this.trigger(["change:"+a]),c.silentGlobalChange||this.trigger(["change"]))},set:function(a){for(var b in a)this.setAttribute(b,a[b],{silentGlobalChange:!0});this.trigger(["change"])}},a.Store=a.Base.extend({_constructor:function(a,b){a&&(a=JSON.parse(JSON.stringify(a))),this.set(a||{}),this.registerComputed(),this.initialize(a,b)},toJSON:function(){return this.data}}),a.CollectionStore=a.Base.extend({_constructor:function(a,b){a=a?JSON.parse(JSON.stringify(a)):[],this.stores=[],this.addBunchFromData(a),this.registerComputed(),this.initialize(a,b)},store:a.Store,storesOnChangeCancelers:{},addBunchFromData:function(a){for(var b=0,c=a.length;c>b;b++){var d=a[b];this.addFromData(d)}},resetFromData:function(a){this.removeAll(),this.addBunchFromData(a)},addBunchStores:function(a){for(var b=0,c=a.length;c>b;b++){var d=a[b];this.addStore(d)}},resetFromStores:function(a){this.removeAll(),this.addBunchStores(storeData)},removeAll:function(){for(var a=this.stores.length-1,b=0;a>=b;a--){var c=this.stores[a];this.removeListenersOn(c)}this.stores=[],this.trigger(["remove","change"])},addFromData:function(a){var b=new this.store(a);return this.addStore(b)},addStore:function(a){if(!this.storeAlreadyAdded(a)){this.stores.push(a);var b=function(){this.trigger(["change:stores","change"])};return this.storesOnChangeCancelers[a.changeEventToken]=a.on(["change"],b.bind(this)),this.trigger(["add","change"]),a}},find:function(a){var b;return a&&(b=this.findWhere({id:a})),b},findWhere:function(a){return this.where(a,!0)[0]},where:function(a,b){var c=[];if(!a)return[];for(var d=0,e=this.stores.length;e>d;d++){var f=this.stores[d],g=!0;for(var h in a)if(f.data[h]!==a[h]){g=!1;break}if(g&&(c.push(f),b))break}return c},storeAlreadyAdded:function(a){return a.data.id?this.find(a.data.id):!1},removeListenersOn:function(a){this.storesOnChangeCancelers[a.changeEventToken].call(),delete this.storesOnChangeCancelers[a.changeEventToken]},remove:function(a){this.removeListenersOn(a),this.stores.splice(this.stores.indexOf(a),1),this.trigger(["remove","change"])},storesToJSON:function(){for(var a=[],b=0,c=this.stores.length;c>b;b++){var d=this.stores[b];a.push(d.toJSON())}return a},toJSON:function(){return{data:this.data,stores:this.storesToJSON()}}}),a.actionHandlers={},a.registerActionHandler=function(b,c){c=a.extend({},c),a.actionHandlers[b]=c;var d=Array.prototype.slice.call(arguments,2);"function"==typeof c.initialize&&c.initialize.apply(c,d)},a.callAction=function(b,c){var d=a.actionHandlers[b];if(!d)throw new Error("Action handler "+b+" not found.");var e=d[c];if(!e)throw new Error("Action "+c+" not found on "+b+" handler.");var f=Array.prototype.slice.call(arguments,2);return e.apply(d,f)},a.ConnectStores=function(b,c){return React.createClass({storesOnChangeCancelers:[],getInitialState:function(){return this.storesState()},storesState:function(){var a={};for(var b in c){var d=c[b];a[b]=d.toJSON()}return a},updateComponentState:function(){this.setState(this.storesState)},componentWillMount:function(){for(var a in c){var b=c[a];this.listenStore(b)}},listenStore:function(a){var b=a.on(["change"],this.updateComponentState.bind(this));this.storesOnChangeCancelers.push(b)},componentWillUnmount:function(){for(var a=0,b=this.storesOnChangeCancelers.length;b>a;a++)this.storesOnChangeCancelers[a].call()},render:function(){return React.createElement(b,a.extend({},this.props,this.state))}})},a});
//# sourceMappingURL=fluxo.map