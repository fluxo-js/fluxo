/*! fluxo v0.0.5 | (c) 2014, 2015 Samuel SimÃµes |  */
!function(a,b){if("function"==typeof define&&define.amd)define([],b);else{if("undefined"!=typeof exports)return module.exports=b();a.Fluxo=b()}}(this,function(){var a={};a.extend=function(a){a=a||{};for(var b=Array.prototype.slice.call(arguments,1),c=0,d=b.length;d>c;c++){var e=b[c];for(var f in e)a[f]=e[f]}return a};var b=function(b,c){var d,e=this;d=function(){return e.apply(this,arguments)},a.extend(d,e,c);var f=function(){this.constructor=d};return f.prototype=e.prototype,d.prototype=new f,b&&a.extend(d.prototype,b),d.__super__=e.prototype,d};return a.Radio={callbackIds:1,events:{},subscribe:function(a,b){var c=this.callbackIds++;return this.events[a]=this.events[a]||{},this.events[a][c]=b,this.removeSubscription.bind(this,a,c)},removeSubscription:function(a,b){this.events[a]=this.events[a]||{},delete this.events[a][b]},publish:function(a){var b=this.events[a]||{};for(var c in b)b[c].apply(null,Array.prototype.slice.call(arguments,1))}},a.Mixin=function(a){for(var b=Array.prototype.slice.call(arguments,1),c=function(b,c){var d=a[b];a[b]=function(){var b=Array.prototype.slice.call(arguments);return c.apply(a,b),d.apply(a,b)}},d=function(b){for(var d in b){var e=b[d];a.hasOwnProperty(d)&&"function"==typeof e?c(d,e):"function"==typeof e?a[d]=e.bind(a):a[d]=e}},e=0,f=b.length;f>e;e++){var g=b[e];d(g)}},a.Base=function(){var b=Array.prototype.slice.call(arguments);this.data={},this.options=b[1]||{},this.changeEventToken=Math.random().toString().slice(2,11),a.Mixin.apply(null,[Object.getPrototypeOf(this)].concat(this.mixins)),this._constructor.apply(this,b)},a.Base.extend=b,a.Base.prototype={initialize:function(){},mixins:[],on:function(b,c){for(var d=[],e=0,f=b.length;f>e;e++){var g=b[e],h=this.changeEventToken+":"+g,i=a.Radio.subscribe(h,c.bind(this));d.push(i)}var j=function(){for(var a=0,b=d.length;b>a;a++){var c=d[a];c.call()}};return j},trigger:function(b){a.Radio.publish(this.changeEventToken+":"+b)},computed:{},attributeParsers:function(){},registerComputed:function(){for(var a in this.computed){var b=this.computed[a];this.on(b,function(a){var b=this[a].call(this);this.setAttribute(a,b)}.bind(this,a)),this.setAttribute(a,this[a].call(this))}},setAttribute:function(a,b,c){c=c||{},this.data[a]!==b&&(this.attributeParsers[a]&&(b=this.attributeParsers[a](b)),this.data[a]=b,this.trigger("change:"+a),c.silentGlobalChange||this.trigger("change"))},set:function(a){for(var b in a)this.setAttribute(b,a[b],{silentGlobalChange:!0});this.trigger("change")}},a.Store=a.Base.extend({_constructor:function(a,b){a&&(a=JSON.parse(JSON.stringify(a))),this.set(a||{}),this.registerComputed(),this.initialize(a,b)},toJSON:function(){return this.data}}),a.CollectionStore=a.Base.extend({_constructor:function(a,b){a=a?JSON.parse(JSON.stringify(a)):[],this.stores=[],this.addBunchFromData(a),this.registerComputed(),this.initialize(a,b)},store:a.Store,storesOnChangeCancelers:{},addBunchFromData:function(a){for(var b=0,c=a.length;c>b;b++){var d=a[b];this.addFromData(d)}},addBunchStores:function(a){for(var b=0,c=a.length;c>b;b++){var d=a[b];this.addStore(d)}},removeAll:function(){for(var a=this.stores.length-1,b=0;a>=b;a--){var c=this.stores[a];this.removeListenersOn(c)}this.stores=[],this.trigger("remove"),this.trigger("change")},addFromData:function(a){var b=new this.store(a);return this.addStore(b)},addStore:function(a){return this.storeAlreadyAdded(a)?void 0:(this.stores.push(a),this.storesOnChangeCancelers[a.changeEventToken]=a.on(["change"],this.trigger.bind(this,"change")),this.trigger("add",a),this.trigger("change"),a)},find:function(a){var b;if(a){for(var c=0,d=this.stores.length;d>c;c++){var e=this.stores[c].data.id;if(e&&e==a){b=this.stores[c];break}}return b}},storeAlreadyAdded:function(a){return this.find(a.data.id)},removeListenersOn:function(a){this.storesOnChangeCancelers[a.changeEventToken].call(),delete this.storesOnChangeCancelers[a.changeEventToken]},remove:function(a){this.removeListenersOn(a),this.stores.splice(this.stores.indexOf(a),1),this.trigger("remove",a),this.trigger("change")},storesToJSON:function(){for(var a=[],b=0,c=this.stores.length;c>b;b++){var d=this.stores[b];a.push(d.toJSON())}return a},toJSON:function(){return{data:this.data,stores:this.storesToJSON()}}}),a.actionHandlers={},a.registerActionHandler=function(b,c){a.actionHandlers[b]=c;var d=Array.prototype.slice.call(arguments,2);"function"==typeof c.initialize&&c.initialize.apply(c,d)},a.callAction=function(b,c){var d=a.actionHandlers[b];if(!d)throw new Error("Action handler "+b+" not found.");var e=d[c];if(!e)throw new Error("Action "+c+" not found on "+b+" handler.");var f=Array.prototype.slice.call(arguments,2);return e.apply(d,f)},a.WatchComponent={storesOnChangeCancelers:[],getInitialState:function(){for(var a={},b=0,c=this.listenProps.length;c>b;b++){var d=this.listenProps[b],e=this.props[d];a[d]=e.toJSON()}return a},componentWillMount:function(){for(var a=0,b=this.listenProps.length;b>a;a++){var c=this.listenProps[a],d=this.props[c];this.listenStore(d,c)}},listenStore:function(a,b){var c=a.on(["change"],function(){var c={};c[b]=a.toJSON(),this.setState(c)}.bind(this));this.storesOnChangeCancelers.push(c)},componentWillUnmount:function(){for(var a=0,b=this.storesOnChangeCancelers.length;b>a;a++)this.storesOnChangeCancelers[a].apply()}},a});
//# sourceMappingURL=fluxo.map