/*! fluxo v0.0.16 | (c) 2014, 2015 Samuel SimÃµes |  */
!function(a,b){if("function"==typeof define&&define.amd)define([],b);else{if("undefined"!=typeof exports)return module.exports=b();a.Fluxo=b()}}(this,function(){var a={storesUUID:1};return a.extend=function(a){a=a||{};for(var b=Array.prototype.slice.call(arguments,1),c=0,d=b.length;d>c;c++){var e=b[c];for(var f in e)a[f]=e[f]}return a},a.Radio={callbackIds:1,events:{},subscribe:function(a,b){var c=this.callbackIds++;return this.events[a]=this.events[a]||{},this.events[a][c]=b,this.removeSubscription.bind(this,a,c)},removeSubscription:function(a,b){this.events[a]=this.events[a]||{},delete this.events[a][b]},publish:function(a){var b=this.events[a]||{};for(var c in b)b[c].apply(null,Array.prototype.slice.call(arguments,1))}},a.ObjectStore={setup:function(){this.cid="FS:"+a.storesUUID++,this._fluxo=!0;var b=this.data;this.data={},this.set(b||{}),this.registerComputed(),this.initialize()},initialize:function(){},create:function(){var b=Array.prototype.slice.call(arguments);b.unshift({},this);var c=a.extend.apply(null,b);return c.setup.apply(c),c},on:function(b,c){for(var d=[],e=0,f=b.length;f>e;e++){var g=b[e],h=this.cid+":"+g,i=a.Radio.subscribe(h,c.bind(this));d.push(i)}var j=function(){for(var a=0,b=d.length;b>a;a++){var c=d[a];c.call()}};return j},triggerEvents:function(a){for(var b=Array.prototype.slice.call(arguments,1),c=0,d=a.length;d>c;c++){var e=a[c];this.triggerEvent.apply(this,[e].concat(b))}},triggerEvent:function(b){var c=this.cid+":"+b,d=Array.prototype.slice.call(arguments,1);a.Radio.publish.apply(a.Radio,[c,this].concat(d)),a.Radio.publish.apply(a.Radio,[this.cid+":*",b,this].concat(d))},computed:{},attributeParsers:function(){},registerComputed:function(){var a=function(a){var b=this[a].call(this);this.setAttribute(a,b)};for(var b in this.computed){var c=this.computed[b];this.on(c,a.bind(this,b)),this.setAttribute(b,this[b].call(this))}},setAttribute:function(a,b,c){c=c||{},this.data[a]!==b&&(this.attributeParsers[a]&&(b=this.attributeParsers[a](b)),this.data[a]=b,this.triggerEvent("change:"+a),c.silentGlobalChange||this.triggerEvent("change"))},unsetAttribute:function(a,b){b=b||{},delete this.data[a],this.triggerEvent("change:"+a),b.silentGlobalChange||this.triggerEvent("change")},set:function(a){for(var b in a)this.setAttribute(b,a[b],{silentGlobalChange:!0});this.triggerEvent("change")},reset:function(a){a=a||{};for(var b in this.data)void 0===a[b]&&this.unsetAttribute(b,{silentGlobalChange:!0});for(var b in a)this.setAttribute(b,a[b],{silentGlobalChange:!0});this.triggerEvent("change")},toJSON:function(){var a=JSON.parse(JSON.stringify(this.data));return a.cid=this.cid,a}},a.CollectionStore=a.ObjectStore.create({setup:function(){var b=this.stores||[];this.stores=[],this.setStores(b),this.createDelegateMethods(),a.ObjectStore.setup.apply(this)},store:{},storesOnChangeCancelers:{},childrenDelegate:[],createDelegateMethods:function(){for(var a=0,b=this.childrenDelegate.length;b>a;a++){var c=this.childrenDelegate[a];this.createDelegateMethod(c)}},createDelegateMethod:function(a){this[a]=function(a,b){var c=Array.prototype.slice.call(arguments,2),d=this.find(b);d[a].apply(d,c)}.bind(this,a)},addStores:function(a){for(var b=0,c=a.length;c>b;b++){var d=a[b];this.addStore(d)}},resetStores:function(a){this.removeAll(),this.addStores(a)},removeAll:function(){for(var a=this.stores.length-1,b=0;a>=b;a--){var c=this.stores[a];this.removeListenersOn(c)}this.stores=[],this.triggerEvents(["remove","change"])},setStores:function(a){for(var b=0,c=a.length;c>b;b++){var d=a[b],e=this.find(d.id||d.cid);e?e.set(d):this.addStore(d)}},addStore:function(b){b._fluxo!==!0&&(b=a.ObjectStore.create(this.store,{data:b}));var c=this.find(b.data.id);if(c)return c;this.stores.push(b);var d=function(a){var b=Array.prototype.slice.call(arguments,1);b.unshift("stores:"+a),this.triggerEvent.apply(this,b)};return this.storesOnChangeCancelers[b.cid]=b.on(["*"],d.bind(this)),this.sort&&this.stores.sort(this.sort),this.triggerEvents(["add","change"]),b},find:function(a){var b;return a&&(b=this.findWhere({id:a}),b||this.stores.some(function(c){return c.cid===a?(b=c,!0):void 0})),b},findWhere:function(a){return this.where(a,!0)[0]},where:function(a,b){var c=[];if(!a)return[];for(var d=0,e=this.stores.length;e>d;d++){var f=this.stores[d],g=!0;for(var h in a)if(f.data[h]!==a[h]){g=!1;break}if(g&&(c.push(f),b))break}return c},removeListenersOn:function(a){this.storesOnChangeCancelers[a.cid].call(),delete this.storesOnChangeCancelers[a.cid]},remove:function(a){this.removeListenersOn(a),this.stores.splice(this.stores.indexOf(a),1),this.triggerEvents(["remove","change"])},storesToJSON:function(){for(var a=[],b=0,c=this.stores.length;c>b;b++){var d=this.stores[b];a.push(d.toJSON())}return a},toJSON:function(){var a=JSON.parse(JSON.stringify(this.data));return a.cid=this.cid,{data:a,stores:this.storesToJSON()}}}),a});
//# sourceMappingURL=fluxo.map